@model int

<h2>Proje İlerleme Raporu</h2>

<!-- Pizza Grafiği için Canvas -->
<div>
    <canvas id="projectProgressChart" width="400" height="400"></canvas>
</div>

<!-- İlerleme Durumu için Yatay Progress Bar -->
<div class="progress" style="margin-top: 20px;">
    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var projectId = @Model; // View'dan gelen projectId
            $.ajax({
                url: '@Url.Action("GetProjectProgress", "Project")', // AJAX çağrısı için doğru action method
                type: 'GET',
                data: { projectId: projectId }, // AJAX requestine projectId'yi gönder
                success: function (data) {
                    // Pizza Grafiğini oluştur
                    var ctx = document.getElementById('projectProgressChart').getContext('2d');
                    var chart = new Chart(ctx, {
                        type: 'doughnut', // Pizza dilimi grafiği
                        data: {
                            labels: ['Tamamlanan Görevler', 'Devam Eden Görevler', 'Geciken Görevler'],
                            datasets: [{
                                label: 'Görev Durumu',
                                data: [data.completedMissions, data.ongoingMissions, data.delayedMissions],
                                backgroundColor: [
                                    'rgba(75, 192, 192, 0.2)', // Tamamlanan
                                    'rgba(255, 159, 64, 0.2)', // Devam eden
                                    'rgba(255, 99, 132, 0.2)'  // Geciken
                                ],
                                borderColor: [
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(255, 159, 64, 1)',
                                    'rgba(255, 99, 132, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top', // Efsane üstte olsun
                                },
                                title: {
                                    display: true,
                                    text: 'Proje İlerleme Durumu' // Başlık
                                }
                            }
                        }
                    });

                    // İlerleme Durumu hesapla ve ilerleme çubuğunu güncelle
                    var totalMissions = data.totalMissions;
                    var completedMissions = data.completedMissions;
                    var progressPercentage = (completedMissions / totalMissions) * 100;

                    // Yatay Progress Bar güncelle
                    $('#progressBar').css('width', progressPercentage + '%');
                    $('#progressBar').attr('aria-valuenow', progressPercentage);
                    $('#progressBar').text(Math.round(progressPercentage) + '%');
                },
                error: function () {
                    alert('İlerleme verileri alınamadı.');
                }
            });
        });
    </script>
}
